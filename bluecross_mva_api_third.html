<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVA Lead Submission (Third) </title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        
        .section-title {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .required::after {
            content: " *";
            color: #e74c3c;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="datetime-local"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            text-decoration: none;
            text-align: center;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-submit {
            background-color: #2ecc71;
            font-size: 18px;
            padding: 15px 40px;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-submit:hover {
            background-color: #27ae60;
        }
        
        .btn-submit:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .response-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 6px;
            background-color: #f8f9fa;
            display: none;
        }
        
        .response-success {
            border-left: 4px solid #2ecc71;
            display: block !important;
        }
        
        .response-error {
            border-left: 4px solid #e74c3c;
            display: block !important;
        }
        
        .response-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .error {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .field-error {
            border-color: #e74c3c !important;
        }
        
        .timestamp-note {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .field-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #3498db;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .response-data {
            background: white;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .field-group {
                grid-template-columns: 1fr;
            }
            
            .radio-group,
            .checkbox-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MVA Transfer Lead Submission (Third)</h1>
        
        <form id="leadForm">
            <!-- Basic Information Section -->
            <div class="section">
                <h2 class="section-title">Lead Information</h2>
                <div class="field-group">
                    <div class="form-group">
                        <label for="arrived_at" class="required">Arrival Time (UTC)</label>
                        <input type="datetime-local" id="arrived_at" name="arrived_at" required>
                        <div class="timestamp-note">Will be converted to UTC format</div>
                        <div class="error" id="arrived_at_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="first_name" class="required">First Name</label>
                        <input type="text" id="first_name" name="first_name" required minlength="2" maxlength="50">
                        <div class="error" id="first_name_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="last_name" class="required">Last Name</label>
                        <input type="text" id="last_name" name="last_name" required minlength="2" maxlength="50">
                        <div class="error" id="last_name_error"></div>
                    </div>
                </div>
                
                <div class="field-group">
                    <div class="form-group">
                        <label for="lead_email" class="required">Email Address</label>
                        <input type="email" id="lead_email" name="lead_email" required>
                        <div class="error" id="lead_email_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="lead_phone" class="required">Phone Number</label>
                        <input type="tel" id="lead_phone" name="lead_phone" required placeholder="+14155552671 or (541) 754-3010">
                        <div class="error" id="lead_phone_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zip_code" class="required">ZIP Code</label>
                        <input type="text" id="zip_code" name="zip_code" required pattern="^\d{5}(-\d{4})?$" placeholder="90210">
                        <div class="error" id="zip_code_error"></div>
                    </div>
                </div>
            </div>
            
            <!-- Certificate Information Section -->
            <div class="section">
                <h2 class="section-title">Certificate Information</h2>
                <div class="field-group">
                    <div class="form-group">
                        <label for="certificate_type" class="required">Certificate Type</label>
                        <select id="certificate_type" name="certificate_type" required>
                            <option value="">Select Type</option>
                            <option value="Jornaya">Jornaya</option>
                            <option value="Trusted Form">Trusted Form</option>
                        </select>
                        <div class="error" id="certificate_type_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="certificate_id" class="required">Certificate ID</label>
                        <input type="text" id="certificate_id" name="certificate_id" required>
                        <div class="error" id="certificate_id_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="certificate_url" class="required">Certificate URL</label>
                        <input type="text" id="certificate_url" name="certificate_url" required placeholder="https://certificate.example.com/id">
                        <div class="error" id="certificate_url_error"></div>
                    </div>
                </div>
                
                <div class="field-group">
                    <div class="form-group">
                        <label for="source_url" class="required">Source URL</label>
                        <input type="text" id="source_url" name="source_url" required value="http://topamericaninsurance.com/auto/">
                        <div class="error" id="source_url_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="ip_address" class="required">IP Address</label>
                        <input type="text" id="ip_address" name="ip_address" required pattern="^(\d{1,3}\.){3}\d{1,3}$" placeholder="47.36.32.241">
                        <div class="error" id="ip_address_error"></div>
                    </div>
                </div>
            </div>
            
            <!-- Auto Accident References Section -->
            <div class="section">
                <h2 class="section-title">Auto Accident Details</h2>
                
                <div class="form-group">
                    <label class="required">When did the accident happen?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="incident_less_1" name="incident_date_option_b" value="Less than 1 year" required>
                            <label for="incident_less_1">Less than 1 year</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="incident_less_2" name="incident_date_option_b" value="Less than 2 years">
                            <label for="incident_less_2">Less than 2 years</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="incident_less_3" name="incident_date_option_b" value="Less than 3 years">
                            <label for="incident_less_3">Less than 3 years</label>
                        </div>
                    </div>
                    <div class="error" id="incident_date_option_b_error"></div>
                </div>
                
                <div class="field-group">
                    <div class="form-group">
                        <label class="required">Were you placed at fault for the accident?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="fault_yes" name="were_you_at_fault" value="Yes" required>
                                <label for="fault_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="fault_no" name="were_you_at_fault" value="No">
                                <label for="fault_no">No</label>
                            </div>
                        </div>
                        <div class="error" id="were_you_at_fault_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="required">Were you injured?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="injured_yes" name="were_you_injured" value="Yes" required>
                                <label for="injured_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="injured_no" name="were_you_injured" value="No">
                                <label for="injured_no">No</label>
                            </div>
                        </div>
                        <div class="error" id="were_you_injured_error"></div>
                    </div>
                </div>
                
                <div class="field-group">
                    <div class="form-group">
                        <label class="required">Do you already have an attorney representing you?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="attorney_yes" name="have_attorney" value="Yes" required>
                                <label for="attorney_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="attorney_no" name="have_attorney" value="No">
                                <label for="attorney_no">No</label>
                            </div>
                        </div>
                        <div class="error" id="have_attorney_error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="required">Were you hospitalized or did you receive medical treatment for your injury?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="treatment_yes" name="doctor_treatment" value="Yes" required>
                                <label for="treatment_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="treatment_no" name="doctor_treatment" value="No">
                                <label for="treatment_no">No</label>
                            </div>
                        </div>
                        <div class="error" id="doctor_treatment_error"></div>
                    </div>
                </div>
                
                <!-- Additional optional fields -->
                <div class="form-group">
                    <label for="role_in_accident">Were you the driver, passenger or pedestrian?</label>
                    <select id="role_in_accident" name="role_in_accident">
                        <option value="">Select Role</option>
                        <option value="driver">Driver</option>
                        <option value="passenger">Passenger</option>
                        <option value="pedestrian">Pedestrian</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="accident_vehicle_count">How many cars were involved in the accident?</label>
                    <input type="text" id="accident_vehicle_count" name="accident_vehicle_count" placeholder="e.g., 2">
                </div>
                
                <div class="form-group">
                    <label for="comments">Additional Case Details</label>
                    <textarea id="comments" name="comments" rows="3" placeholder="Briefly describe your case"></textarea>
                </div>
            </div>
            
            <button type="submit" class="btn btn-submit" id="submitBtn">Submit Lead</button>
        </form>
        
        <!-- Loading Indicator -->
        <div class="loading" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <p>Sending request to API...</p>
        </div>
        
        <!-- Response Container -->
        <div class="response-container" id="responseContainer">
            <div id="responseContent"></div>
        </div>
    </div>

    <script>
        // API endpoint
const url= 'https://rtb.ringba.com/v1/production/4ba236ba769c4d4cbfe0d9aa0c6c8b9b.json';
        const API_URL = 'https://api.formifyweb.com/proxify.php?url=' + encodeURIComponent(url);
        
        // Format date to UTC ISO string
        function formatToUTC(dateInput) {
            const date = new Date(dateInput);
            return date.toISOString();
        }
        
        // Validate phone number
        function validatePhone(phone) {
            const usDomesticRegex = /^\(\d{3}\)\s\d{3}-\d{4}$/;
            const e164Regex = /^\+\d{10,15}$/;
            return usDomesticRegex.test(phone) || e164Regex.test(phone);
        }
        
        // Validate ZIP code
        function validateZipCode(zip) {
            const zipRegex = /^\d{5}(-\d{4})?$/;
            return zipRegex.test(zip);
        }
        
        // Validate IP address
        function validateIP(ip) {
            const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!ipRegex.test(ip)) return false;
            
            const parts = ip.split('.');
            return parts.every(part => {
                const num = parseInt(part, 10);
                return num >= 0 && num <= 255;
            });
        }
        
        // Show error message
        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + '_error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
            
            const inputElement = document.getElementById(fieldId);
            if (inputElement) {
                inputElement.classList.add('field-error');
            }
        }
        
        // Clear error message
        function clearError(fieldId) {
            const errorElement = document.getElementById(fieldId + '_error');
            if (errorElement) {
                errorElement.style.display = 'none';
            }
            
            const inputElement = document.getElementById(fieldId);
            if (inputElement) {
                inputElement.classList.remove('field-error');
            }
        }
        
        // Validate form
        function validateForm() {
            let isValid = true;
            
            // Clear all errors first
            const allFields = [
                'arrived_at', 'first_name', 'last_name', 'lead_email', 'lead_phone', 'zip_code',
                'certificate_type', 'certificate_id', 'certificate_url', 'source_url', 'ip_address',
                'incident_date_option_b', 'were_you_at_fault', 'were_you_injured', 'have_attorney', 'doctor_treatment'
            ];
            
            allFields.forEach(field => clearError(field));
            
            // Validate required fields
            const requiredFields = [
                { id: 'first_name', name: 'First Name', minLength: 2 },
                { id: 'last_name', name: 'Last Name', minLength: 2 },
                { id: 'lead_email', name: 'Email Address' },
                { id: 'lead_phone', name: 'Phone Number', custom: validatePhone },
                { id: 'zip_code', name: 'ZIP Code', custom: validateZipCode },
                { id: 'certificate_type', name: 'Certificate Type' },
                { id: 'certificate_id', name: 'Certificate ID' },
                { id: 'certificate_url', name: 'Certificate URL' },
                { id: 'source_url', name: 'Source URL' },
                { id: 'ip_address', name: 'IP Address', custom: validateIP }
            ];
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                const value = element ? element.value.trim() : '';
                
                if (!value) {
                    showError(field.id, `${field.name} is required`);
                    isValid = false;
                } else if (field.minLength && value.length < field.minLength) {
                    showError(field.id, `${field.name} must be at least ${field.minLength} characters`);
                    isValid = false;
                } else if (field.custom && !field.custom(value)) {
                    showError(field.id, `${field.name} is invalid`);
                    isValid = false;
                }
            });
            
            // Validate date/time
            const arrivedAt = document.getElementById('arrived_at').value;
            if (!arrivedAt) {
                showError('arrived_at', 'Arrival Time is required');
                isValid = false;
            }
            
            // Validate radio button groups
            const radioGroups = [
                { name: 'incident_date_option_b', display: 'Incident Date' },
                { name: 'were_you_at_fault', display: 'Fault Status' },
                { name: 'were_you_injured', display: 'Injury Status' },
                { name: 'have_attorney', display: 'Attorney Representation' },
                { name: 'doctor_treatment', display: 'Medical Treatment' }
            ];
            
            radioGroups.forEach(group => {
                const selected = document.querySelector(`input[name="${group.name}"]:checked`);
                if (!selected) {
                    showError(group.name, `${group.display} is required`);
                    isValid = false;
                }
            });
            
            return isValid;
        }
        
        // Handle form submission
        document.getElementById('leadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate form
            if (!validateForm()) {
                return;
            }
            
            // Disable submit button and show loading
            const submitBtn = document.getElementById('submitBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const responseContainer = document.getElementById('responseContainer');
            const responseContent = document.getElementById('responseContent');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            loadingIndicator.style.display = 'block';
            responseContainer.style.display = 'none';
            
            // Build query string parameters
            const params = new URLSearchParams();
            
            // Add main parameters
            params.append('arrived_at', formatToUTC(document.getElementById('arrived_at').value));
            params.append('first_name', document.getElementById('first_name').value.trim());
            params.append('last_name', document.getElementById('last_name').value.trim());
            params.append('lead_email', document.getElementById('lead_email').value.trim());
            params.append('lead_phone', document.getElementById('lead_phone').value.trim());
            params.append('zip_code', document.getElementById('zip_code').value.trim());
            params.append('CID', document.getElementById('lead_phone').value.trim()); // Add cid parameter
            
            // Add certificate and reference fields as individual parameters
            params.append('certificate_type', document.getElementById('certificate_type').value);
            params.append('certificate_id', document.getElementById('certificate_id').value.trim());
            params.append('certificate_url', document.getElementById('certificate_url').value.trim());
            params.append('source_url', document.getElementById('source_url').value.trim());
            params.append('ip_address', document.getElementById('ip_address').value.trim());
            params.append('incident_date_option_b', document.querySelector('input[name="incident_date_option_b"]:checked').value);
            params.append('were_you_at_fault', document.querySelector('input[name="were_you_at_fault"]:checked').value);
            params.append('were_you_injured', document.querySelector('input[name="were_you_injured"]:checked').value);
            params.append('have_attorney', document.querySelector('input[name="have_attorney"]:checked').value);
            params.append('doctor_treatment', document.querySelector('input[name="doctor_treatment"]:checked').value);
            
            // Add optional fields if provided
            const roleInAccident = document.getElementById('role_in_accident').value;
            if (roleInAccident) {
                params.append('role_in_accident', roleInAccident);
            }
            
            const accidentVehicleCount = document.getElementById('accident_vehicle_count').value.trim();
            if (accidentVehicleCount) {
                params.append('accident_vehicle_count', accidentVehicleCount);
            }
            
            const comments = document.getElementById('comments').value.trim();
            if (comments) {
                params.append('comments', comments);
            }
            
            try {
                // Send GET request with query string
                const queryString = params.toString();
                const fullUrl = `${API_URL}?${queryString}`;
                
                console.log('Sending request to:', fullUrl);
                
                const response = await fetch(fullUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                // Update response container
                if (response.ok) {
                    responseContainer.className = 'response-container response-success';
                    responseContent.innerHTML = `
                        <div class="response-title">✅ Lead Submitted Successfully!</div>
                        <div>Status: ${response.status} ${response.statusText}</div>
                        <div>API Response:</div>
                        <div class="response-data">${JSON.stringify(result, null, 2)}</div>
                    `;
                } else {
                    responseContainer.className = 'response-container response-error';
                    responseContent.innerHTML = `
                        <div class="response-title">❌ Submission Failed</div>
                        <div>Status: ${response.status} ${response.statusText}</div>
                        <div>Error Details:</div>
                        <div class="response-data">${JSON.stringify(result, null, 2)}</div>
                    `;
                }
                
                responseContainer.style.display = 'block';
                
            } catch (error) {
                // Network error
                responseContainer.className = 'response-container response-error';
                responseContent.innerHTML = `
                    <div class="response-title">❌ Network Error</div>
                    <div>${error.message}</div>
                    <div>Request URL:</div>
                    <div class="response-data">${API_URL}?${params.toString()}</div>
                `;
                responseContainer.style.display = 'block';
            } finally {
                // Re-enable submit button and hide loading
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Lead';
                loadingIndicator.style.display = 'none';
                
                // DO NOT reset form fields - form data stays as entered
            }
        });
        
        // Set default values
        document.addEventListener('DOMContentLoaded', function() {
            // Set default arrival time to current time
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('arrived_at').value = localDateTime;
            
            // Set default source URL
            document.getElementById('source_url').value = 'http://topamericaninsurance.com/auto/';
            
            // Set default radio selections (optional - uncomment if needed)
            // document.getElementById('incident_less_1').checked = true;
            // document.getElementById('fault_no').checked = true;
            // document.getElementById('injured_yes').checked = true;
            // document.getElementById('attorney_no').checked = true;
            // document.getElementById('treatment_yes').checked = true;
        });
        
        // Real-time validation
        document.getElementById('lead_phone').addEventListener('blur', function() {
            if (this.value.trim() && !validatePhone(this.value.trim())) {
                showError('lead_phone', 'Please use format: (541) 754-3010 or +14155552671');
            } else {
                clearError('lead_phone');
            }
        });
        
        document.getElementById('zip_code').addEventListener('blur', function() {
            if (this.value.trim() && !validateZipCode(this.value.trim())) {
                showError('zip_code', 'Please enter a valid ZIP code (e.g., 90210 or 90210-1234)');
            } else {
                clearError('zip_code');
            }
        });
        
        document.getElementById('ip_address').addEventListener('blur', function() {
            if (this.value.trim() && !validateIP(this.value.trim())) {
                showError('ip_address', 'Please enter a valid IP address (e.g., 47.36.32.241)');
            } else {
                clearError('ip_address');
            }
        });
        
        // Clear errors on input
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                const fieldId = this.id;
                if (fieldId) {
                    clearError(fieldId);
                }
            });
        });
        
        // Clear radio button errors when selected
        const radioGroups = ['incident_date_option_b', 'were_you_at_fault', 'were_you_injured', 'have_attorney', 'doctor_treatment'];
        radioGroups.forEach(groupName => {
            document.querySelectorAll(`input[name="${groupName}"]`).forEach(radio => {
                radio.addEventListener('change', function() {
                    clearError(groupName);
                });
            });
        });
    </script>
</body>
</html>
